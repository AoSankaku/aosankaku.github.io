---
title: "【Minecraft】マイクラサーバーでDiscordに通知を送るスクリプトを作りました"
category: "Minecraft"
date: "2023-09-21 12:00:00 +09:00"
desc: "PythonとWebhookを利用した"
thumbnail: ""
---

嘘つきました。正確には作っていません。超大幅な改良を加えました。

# 簡単に使えるサーバー通知BOTがほしい！
## サーバー参加者のモチベの問題
最近、訳あってマイクラサーバーを開いたり閉じたりしています。

参加者視点では、「今サーバーに人がいるのかどうか」というのは結構重要だったりします。やっぱり人がいるときのほうが「行きてえなあ…行きましょうよ」ってなりやすいですからね。しょうがないですね。

しかし当然のことながら、マイクラサーバー自体にはそういう通知をしてくれる機能などありません。プラグインならあります。

https://www.spigotmc.org/resources/discordsrv.18494/

## 要件
技術の選定に当たり、以下を重視しました。
- batまたはshでないこと
  - 単純にUbuntuとWindowsで交互に互換性がありません。基本的にはUbuntuで動かすとは思いますが、デバッグの容易さや個人が自宅でポート開放して小さいサーバーを開く状況を考えると、OSに依存せず動かせるものが理想です。
- バニラ、Forge、Fabric、プラグインサーバーのいずれでもうごく普遍的（ユニバーサル）で独立（スタンドアロン）なスクリプトであること
  - BOTではこれは不可能です。また、BOT作成の手間も結構あります。正直言って小規模サーバーを作るためだけにBOTを作成するのは結構だるいです。
- Webhookを使用すること
  - これができるとDiscordでの通知が簡単になります。

## 方法
しかし、いくつかの方法で取得することはできそうです。

1. マイクラサーバーの標準出力を受け取り、それを元に処理を行う
  - ブログを書いている今思いついたアイデアなのですが、[ありました](https://qiita.com/yutake27/items/033155608d64eac0adc2)。
  - こっちで作ってみてもいいかもしれない…というかこっちのほうが断然簡単じゃない？あーしくった……😫
2. マイクラ標準のログを利用する
  - マイクラは「latest.log」というファイルを都度出力します。これを監視して通知に加工してやろう、という算段です。

今回は2番を採用しました。まじでなんで1じゃなくてこっちを改造したんだろう。馬鹿じゃん。

## あった
ひとまず「Discord minecraft サーバー 通知」とか、そんな感じで適当なキーワードで検索したら出てきました。コレです。

https://qiita.com/somakai_sumasi/items/6dc76c5eaabe53c8118e

https://github.com/somakai-sumasi/Send-Minecraft-notifications

しかし、大量のバグや問題点がありました。

- latest.logは1行ずつ更新するとは限らないため、複数行更新すると一気に意味がわからなくなる
- サーバーの起動、閉鎖に関するログが流れなかった
- `README.md`が充実していないために、使い方がPythonを知らないとよくわからない

ということで、これを超大規模改修して、実用に足る水準まで上げました。

![screenshot](images/image.png)

実用するとこんな感じです。中々でしょう？

## 内容
https://github.com/AoSankaku/Send-Minecraft-notifications#send-minecraft-notifications%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%AA%AC%E6%98%8E

ここにすべてを置いてきました。使い方から変更点まですべて書いてあります。つまりこの記事はただの宣伝用です。ハハハハ。





